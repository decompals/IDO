#include <gl/gl.h>

Matrix beziermatrix = {
    {-1.0,  3.0, -3.0, 1.0},
    { 3.0, -6.0,  3.0, 0.0},
    {-3.0,  3.0,  0.0, 0.0},
    { 1.0,  0.0,  0.0, 0.0} 
};

Matrix geom3 = {
    {100.0, 200.0, 0.0, 1.0},
    {200.0, 300.0, 0.0, 1.0},
    {200.0, 100.0, 0.0, 1.0},
    {300.0, 200.0, 0.0, 1.0} 
};

Matrix precisionmatrix = {
    {6.0/8000.0, 0.0,	    0.0,      0.0},
    {6.0/8000.0, 2.0/400.0, 0.0,      0.0},
    {1.0/8000.0, 1.0/400.0, 1.0/20.0, 0.0},
    {0.0,	 0.0,	    0.0,      1.0}
};

main()
{
    int i;

    prefsize(400, 400);
    winopen("curve3");
    color(BLACK);
    clear();

    pushmatrix();		/* the current transformation (ortho2) 
				 * matrix on the matrix stack is saved */
    multmatrix(geom3);          /* the product of the current transformation
                                 * matrix and the matrix containing the 
				 * control points becomes the new current 
				 * transformation matrix */
    multmatrix(beziermatrix);   /* the product of the basis matrix and the
                                 * current transformation matrix becomes the 
				 * new current transformation matrix */
    multmatrix(precisionmatrix);/* the product of the precision matrix
                                 * and the current transformation matrix 
				 * becomes the new current transformation 
				 * matrix */
    move(0.0, 0.0, 0.0);        /* this command must be issued so that the 
                                 * correct first point is generated by the 
				 * curveit command */
    color(RED);
    curveit(20);                /* a curve consisting of 20 line segments 
				 * is drawn */
    popmatrix();                /* the original transformation matrix is 
				 * restored */

    color(WHITE);		/* show the control points */ 
    for (i = 0; i < 4; i++)
	circf(geom3[i][0], geom3[i][1], 1.5);

    sleep(10);
    gexit();
    return 0;
}
